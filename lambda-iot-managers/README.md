# ğŸ”Œ IoT Lambda Managers

> **IoT Core â†’ SQS Bridge Lambda Functions for Robot Data Collection**

ì´ í´ë”ì—ëŠ” ë¡œë´‡ì—ì„œ IoT Coreë¡œ ì „ì†¡ë˜ëŠ” ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•˜ì—¬ SQS FIFO íë¡œ ì „ë‹¬í•˜ëŠ” AWS Lambda í•¨ìˆ˜ë“¤ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì„¸ ê°€ì§€ íƒ€ì…ì˜ ë°ì´í„° ì±„ë„ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤:

## ğŸ“¦ êµ¬ì„± ìš”ì†Œ

### 1. Detection Manager
**ëª©ì **: ë¡œë´‡ì˜ ê°ì§€/ì¸ì‹ ë°ì´í„° ìˆ˜ì§‘
- **SQS í**: `robo_detection.fifo`
- **IoT Topic**: `robo/detection`
- **ë©”ì‹œì§€ íƒ€ì…**: ë¬¼ì²´ ê°ì§€, ì–¼êµ´ ì¸ì‹, ìœ„í—˜ ìƒí™© ê°ì§€ ë“±

### 2. Feedback Manager  
**ëª©ì **: ë¡œë´‡ ìƒíƒœ ë° ì„¼ì„œ ë°ì´í„° ì‹¤ì‹œê°„ ìˆ˜ì§‘
- **SQS í**: `robo_feedback.fifo`
- **IoT Topic**: `robo/feedback`
- **ë©”ì‹œì§€ íƒ€ì…**: ë¡œë´‡ ìƒíƒœ, ì„¼ì„œ ë°ì´í„°, ì‘ì—… ê²°ê³¼, ë°°í„°ë¦¬ ë ˆë²¨ ë“±

### 3. Gesture Manager
**ëª©ì **: ë¡œë´‡ì˜ ì œìŠ¤ì²˜ ë° ë™ì‘ ë°ì´í„° ìˆ˜ì§‘
- **SQS í**: `robo_gesture.fifo`
- **IoT Topic**: `robo/gesture`
- **ë©”ì‹œì§€ íƒ€ì…**: ë¡œë´‡ ë™ì‘, í‘œí˜„, ì´ë²¤íŠ¸ ë“±

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Robot Device  â”‚
â”‚   (IoT Client)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AWS IoT Core   â”‚
â”‚  (MQTT Broker)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â–¼         â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Detect â”‚ â”‚ Feed. â”‚ â”‚Gestureâ”‚
â”‚Manager â”‚ â”‚Managerâ”‚ â”‚Managerâ”‚
â”‚ Lambda â”‚ â”‚ Lambdaâ”‚ â”‚ Lambdaâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜
     â”‚         â”‚         â”‚
     â–¼         â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚robo_   â”‚ â”‚robo_   â”‚ â”‚robo_   â”‚
â”‚detec.  â”‚ â”‚feedbackâ”‚ â”‚gesture â”‚
â”‚.fifo   â”‚ â”‚.fifo   â”‚ â”‚.fifo   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚         â”‚         â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Agent   â”‚
     â”‚ Runtime  â”‚
     â”‚(Consumer)â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ ê³µí†µ ê¸°ëŠ¥

ëª¨ë“  ë§¤ë‹ˆì €ëŠ” ë™ì¼í•œ íŒ¨í„´ì„ ë”°ë¦…ë‹ˆë‹¤:

### ğŸ“¥ ì…ë ¥
- **ì†ŒìŠ¤**: AWS IoT Core (MQTT ë©”ì‹œì§€)
- **íŠ¸ë¦¬ê±°**: IoT Ruleì— ì˜í•´ Lambda ìë™ í˜¸ì¶œ
- **í˜•ì‹**: JSON ë©”ì‹œì§€

### ğŸ”„ ì²˜ë¦¬
1. IoT Coreì—ì„œ ë©”ì‹œì§€ ìˆ˜ì‹ 
2. ë©”ì‹œì§€ë¥¼ SQS FIFO íë¡œ ì „ë‹¬
3. ë©”íƒ€ë°ì´í„° ì¶”ê°€ (íƒ€ì„ìŠ¤íƒ¬í”„, ì†ŒìŠ¤ ë“±)
4. ì¤‘ë³µ ì œê±° (FIFO íì˜ ContentBasedDeduplication)

### ğŸ“¤ ì¶œë ¥
- **ëª©ì ì§€**: SQS FIFO Queue
- **íŠ¹ì§•**: 
  - ìˆœì°¨ì  ì²˜ë¦¬ ë³´ì¥ (FIFO)
  - ìµœì†Œ 1íšŒ ì „ë‹¬ ë³´ì¥ (at-least-once delivery)
  - ë©”ì‹œì§€ ê·¸ë£¹ë³„ ìˆœì„œ ë³´ì¥

## ğŸš€ ë°°í¬ ë°©ë²•

ê° ë§¤ë‹ˆì €ëŠ” ë…ë¦½ì ìœ¼ë¡œ ë°°í¬ë©ë‹ˆë‹¤:

```bash
# Detection Manager ë°°í¬
cd detection-manager
python create_detection_manager.py

# Feedback Manager ë°°í¬
cd feedback-manager
python create_feedback_manager.py

# Gesture Manager ë°°í¬
cd gesture-manager
python create_gesture_manager.py
```

ê° ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒ AWS ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤:
- SQS FIFO í
- Lambda í•¨ìˆ˜
- IAM ì—­í•  ë° ì •ì±…
- IoT Rule (ìë™ íŠ¸ë¦¬ê±° ì„¤ì •)

## ğŸ” ëª¨ë‹ˆí„°ë§

ëª¨ë“  Lambda í•¨ìˆ˜ëŠ” CloudWatchì—ì„œ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **ë©”íŠ¸ë¦­**: í˜¸ì¶œ ìˆ˜, ì˜¤ë¥˜ìœ¨, ì§€ì† ì‹œê°„, ì½œë“œ ìŠ¤íƒ€íŠ¸
- **ë¡œê·¸**: `/aws/lambda/lambda-{manager}-for-robo`
- **ì•ŒëŒ**: SQS í ê¹Šì´, Lambda ì˜¤ë¥˜ìœ¨ ë“±

## ğŸ§ª í…ŒìŠ¤íŠ¸

ê° ë§¤ë‹ˆì €ì—ëŠ” í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

```bash
# Detection í…ŒìŠ¤íŠ¸
cd detection-manager
python test_detection.py

# Feedback í…ŒìŠ¤íŠ¸
cd feedback-manager
python test_feedback.py

# Gesture í…ŒìŠ¤íŠ¸
cd gesture-manager
python test_gesture.py
```

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- [Detection Manager](detection-manager/) - ê°ì§€/ì¸ì‹ ë°ì´í„° ì²˜ë¦¬
- [Feedback Manager](feedback-manager/README.md) - ë¡œë´‡ ìƒíƒœ ë° ì„¼ì„œ ë°ì´í„°
- [Gesture Manager](gesture-manager/) - ì œìŠ¤ì²˜ ë° ë™ì‘ ë°ì´í„°

## ğŸ”— ê´€ë ¨ ì»´í¬ë„ŒíŠ¸

ì´ Lambda í•¨ìˆ˜ë“¤ê³¼ ì—°ê³„ë˜ëŠ” ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸:
- **Agent Runtime** (`../agent-runtime/`) - SQS ë©”ì‹œì§€ ì†Œë¹„ ë° ì²˜ë¦¬
- **Robo Controller** (`../robo-controller/`) - ë¡œë´‡ ì œì–´ ëª…ë ¹ ì‹¤í–‰
- **Agent Gateway** (`../agent-gateway/`) - MCP ì¸í„°í˜ì´ìŠ¤

## ğŸ”’ ë³´ì•ˆ

- **IAM ê¶Œí•œ**: ê° LambdaëŠ” ìµœì†Œ ê¶Œí•œ ì›ì¹™ì— ë”°ë¼ í•„ìš”í•œ ê¶Œí•œë§Œ ë¶€ì—¬
- **ì•”í˜¸í™”**: SQS ë©”ì‹œì§€ ì•”í˜¸í™” í™œì„±í™”
- **ë„¤íŠ¸ì›Œí¬**: VPC ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•œ ë„¤íŠ¸ì›Œí¬ ê²©ë¦¬ ê°€ëŠ¥
- **ê²€ì¦**: ì…ë ¥ ë©”ì‹œì§€ ìœ íš¨ì„± ê²€ì‚¬ ë° ì˜¤ë¥˜ ì²˜ë¦¬

