# ğŸ§  Agentic AI Runtime - ë¡œë´‡ ì œì–´ ë°±ì—”ë“œ

> **Amazon Bedrock ê¸°ë°˜ ì§€ëŠ¥í˜• ë¡œë´‡ ì œì–´ ì‹œìŠ¤í…œ**

ì´ ì»´í¬ë„ŒíŠ¸ëŠ” Agentic AIì˜ í•µì‹¬ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë¡œ, ìì—°ì–´ ëª…ë ¹ì„ ì´í•´í•˜ê³  ë¡œë´‡ ì œì–´ ëª…ë ¹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì§€ëŠ¥í˜• ì—ì´ì „íŠ¸ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤. Amazon Bedrock ëª¨ë¸ì„ í™œìš©í•˜ì—¬ ì‹¤ì‹œê°„ ëŒ€í™” ì²˜ë¦¬ì™€ ë¡œë´‡ ì œì–´ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### ğŸ¤– ì§€ëŠ¥í˜• ë¡œë´‡ ì œì–´
- **ìì—°ì–´ ëª…ë ¹ í•´ì„**: ì‚¬ìš©ìì˜ ìì—°ì–´ ì…ë ¥ì„ ë¡œë´‡ ì œì–´ ëª…ë ¹ìœ¼ë¡œ ë³€í™˜
- **MCP í†µí•©**: Model Context Protocolì„ í†µí•œ í™•ì¥ ê°€ëŠ¥í•œ ë„êµ¬ ì—°ë™
- **ëª…ë ¹ ìš°ì„ ìˆœìœ„ ê´€ë¦¬**: ë¹„ìƒ ìƒí™©ê³¼ ì¼ë°˜ ëª…ë ¹ì˜ ìš°ì„ ìˆœìœ„ ì²˜ë¦¬
- **ì‹¤ì‹œê°„ ì‘ë‹µ**: ìŠ¤íŠ¸ë¦¬ë°ì„ í†µí•œ ì¦‰ê°ì ì¸ í”¼ë“œë°± ì œê³µ

### ğŸ§  AI ì—ì´ì „íŠ¸ ì—”ì§„
- **Bedrock ëª¨ë¸**: ìµœì‹  ìƒì„±í˜• AI ëª¨ë¸ í™œìš©
- **ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬**: ì´ì „ ëŒ€í™” ë‚´ìš©ì„ ê¸°ì–µí•˜ëŠ” ì»¨í…ìŠ¤íŠ¸ ìœ ì§€
- **ë©€í‹°ëª¨ë‹¬ ì²˜ë¦¬**: í…ìŠ¤íŠ¸, ì´ë¯¸ì§€, ì„¼ì„œ ë°ì´í„° í†µí•© ì²˜ë¦¬
- **ë™ì  ê³„íš ìˆ˜ë¦½**: ìƒí™©ì— ë”°ë¥¸ ìµœì ì˜ ë¡œë´‡ í–‰ë™ ê³„íš

### ğŸ”„ ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬
- **SQS ìŠ¤íŠ¸ë¦¬ë°**: FIFO íë¥¼ í†µí•œ ìˆœì°¨ì  ë°ì´í„° ì²˜ë¦¬
- **IoT ì„¼ì„œ í†µí•©**: ë‹¤ì–‘í•œ ì„¼ì„œ ë°ì´í„°ì˜ ì‹¤ì‹œê°„ ìˆ˜ì§‘ ë° ë¶„ì„
- **ì´ë²¤íŠ¸ ê¸°ë°˜ ì²˜ë¦¬**: ë¹„ë™ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬ë¡œ ë†’ì€ ì„±ëŠ¥ ë³´ì¥
- **ì˜¤ë¥˜ ë³µêµ¬**: ìë™ ì¬ì‹œë„ ë° ì˜¤ë¥˜ ì²˜ë¦¬ ë©”ì»¤ë‹ˆì¦˜

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚â”€â”€â”€â–¶â”‚  Agent Runtime   â”‚â”€â”€â”€â–¶â”‚   MCP Gateway   â”‚
â”‚  (React)        â”‚    â”‚  (Bedrock)       â”‚    â”‚   (Lambda)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                        â”‚
                                â–¼                        â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   SQS Queues     â”‚    â”‚   Robot         â”‚
                       â”‚  (Feedback/      â”‚    â”‚   Controller    â”‚
                       â”‚   Detection)     â”‚    â”‚                 â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 1. Agent Manager (`core/agent_manager.py`)
- Bedrock Claude ëª¨ë¸ê³¼ì˜ ì§ì ‘ í†µì‹ 
- ëŒ€í™” ì„¸ì…˜ ê´€ë¦¬ ë° ì»¨í…ìŠ¤íŠ¸ ìœ ì§€
- ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬

### 2. MCP Manager (`core/mcp_manager.py`)
- Model Context Protocol ì„œë²„ ê´€ë¦¬
- ë„êµ¬ í˜¸ì¶œ ë° ì‘ë‹µ ì²˜ë¦¬
- ë¡œë´‡ ì œì–´ ëª…ë ¹ ë³€í™˜

### 3. Stream Processor (`core/stream_processor.py`)
- SQS íì—ì„œ ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹ 
- IoT ì„¼ì„œ ë°ì´í„° ì²˜ë¦¬
- ì´ë²¤íŠ¸ ê¸°ë°˜ ì•Œë¦¼ ì‹œìŠ¤í…œ

### 4. Memory Hook (`memory/memory_hook.py`)
- ëŒ€í™” íˆìŠ¤í† ë¦¬ ì €ì¥ ë° ê´€ë¦¬
- ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ì‘ë‹µ ìƒì„±
- ì¥ê¸° ê¸°ì–µ ì‹œìŠ¤í…œ

## ğŸ“‹ ì§€ì›í•˜ëŠ” ë¡œë´‡ ëª…ë ¹

### ê¸°ë³¸ ë™ì‘ ëª…ë ¹
| ëª…ë ¹ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| `HAPPY` | ê¸°ìœ ìƒíƒœ í‘œí˜„ | "ì˜¤ëŠ˜ì€ ì •ë§ ë©‹ì§€ë„¤ìš”!" |
| `NEUTRAL` | ì¤‘ë¦½ì  ìƒíƒœ í‘œí˜„ | "ì¼ìƒì ì¸ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤" |
| `SAD` | ìŠ¬í”ˆ ìƒíƒœ í‘œí˜„ | "ì•ˆíƒ€ê¹Œìš´ ìƒí™©ì´ ë°œìƒí–ˆë„¤ìš”" |
| `ANGRY` | í™”ë‚œ ìƒíƒœ í‘œí˜„ | "ìœ„í—˜í•œ ìƒí™©ì„ ê°ì§€í–ˆìŠµë‹ˆë‹¤!" |

### ê³ ê¸‰ ëª…ë ¹ (í™•ì¥ ê°€ëŠ¥)
- **ìˆœì°° ëª…ë ¹**: "ìœ„í—˜ êµ¬ì—­ì„ ìˆœì°°í•´ ì¤˜"
- **ì˜ìƒ ëª…ë ¹**: "í™”ì¬ê°€ ë°œìƒí•œ ê³³ì˜ ì˜ìƒì„ ë³´ì—¬ì¤˜"
- **ìƒíƒœ í™•ì¸**: "í˜„ì¬ ë¡œë´‡ ìƒíƒœë¥¼ ì•Œë ¤ì¤˜"
- **ë¹„ìƒ ì •ì§€**: "ì¦‰ì‹œ ì •ì§€í•´!"

## âš™ï¸ ì„¤ì¹˜ ë° ì‹¤í–‰

### 1. í™˜ê²½ ì„¤ì •

```bash
# ì €ì¥ì†Œ í´ë¡ 
git clone <repository-url>
cd agent-runtime

# ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
uv venv
source .venv/bin/activate

# ì˜ì¡´ì„± ì„¤ì¹˜
uv pip install -r requirements.txt
# ë˜ëŠ” pyproject.toml ì‚¬ìš©
uv sync
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

#### `config.json` íŒŒì¼ ì„¤ì •
```json
{
    "model_id": "us.anthropic.claude-3-5-haiku-20241022-v1:0",
    "gateway_url": "https://your-gateway-id.gateway.bedrock-agentcore.us-west-2.amazonaws.com/mcp",
    "cognito": {
        "client_id": "your_cognito_client_id",
        "test_username": "your_username",
        "test_password": "your_password"
    },
    "feedback_queue_name": "robo_feedback",
    "detection_queue_name": "robo_detection",
    "gesture_queue_name": "robo_gesture"
}
```

#### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# AWS ê¸°ë³¸ ì„¤ì • (IAM ì—­í•  ì‚¬ìš© ì‹œ ë¶ˆí•„ìš”)
export AWS_REGION=us-west-2

# Cognito ì¸ì¦ ì„¤ì • (config.jsonì—ì„œë„ ì„¤ì • ê°€ëŠ¥)
export COGNITO_CLIENT_ID=your_cognito_client_id
export COGNITO_USERNAME=your_cognito_username
export COGNITO_PASSWORD=your_cognito_password

# AWS Secrets Manager ì„¤ì •
export SECRET_NAME=your_secret_name_for_bearer_token
```

**ì°¸ê³ **: ëŒ€ë¶€ë¶„ì˜ ì„¤ì •ì€ `config.json` íŒŒì¼ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤. í™˜ê²½ ë³€ìˆ˜ëŠ” ì„ íƒì‚¬í•­ì´ë©°, `config.json`ì— ì„¤ì •ëœ ê°’ì´ ìš°ì„ ë©ë‹ˆë‹¤.

### 3. ì‹¤í–‰ ë°©ë²•

#### Bedrock AgentCore Runtime ë°°í¬ (ê¶Œì¥)
```bash
# Prerequisites ì„¤ì¹˜
pip install bedrock-agentcore-starter-toolkit jq

# AWS CLI ì„¤ì • í™•ì¸
aws sts get-caller-identity

# ë°°í¬ ì‹¤í–‰
./scripts/deploy.sh
```

#### ê°œë°œ ëª¨ë“œ (ë¡œì»¬ ì‹¤í–‰)
```bash
# ì§ì ‘ ì‹¤í–‰
uv run python main.py

# ë˜ëŠ” uvicorn ì‚¬ìš©
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

#### Docker ì‹¤í–‰
```bash
# Docker ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t agentic-ai-runtime .

# Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -p 8000:8000 --env-file .env agentic-ai-runtime
```

## ğŸ”§ ì‚¬ìš© ë°©ë²•

### 1. ê¸°ë³¸ ëŒ€í™” ì‹œì‘

```python
from core.agent_manager import AgentManager
from core.mcp_manager import MCPManager

# Agent Manager ì´ˆê¸°í™”
agent_manager = AgentManager()

# MCP Manager ì´ˆê¸°í™”
mcp_manager = MCPManager()

# ëŒ€í™” ì„¸ì…˜ ì‹œì‘
session_id = "user_session_001"
user_message = "ì•ˆë…•í•˜ì„¸ìš”! ë¡œë´‡ì„ ê¸°ì˜ê²Œ ë§Œë“¤ì–´ ì£¼ì„¸ìš”."

# AI ì‘ë‹µ ìƒì„±
response = await agent_manager.process_message(
    message=user_message,
    session_id=session_id
)

print(f"AI ì‘ë‹µ: {response}")
```

### 2. ë¡œë´‡ ì œì–´ ëª…ë ¹ ì‹¤í–‰

```python
# ë¡œë´‡ ì œì–´ ëª…ë ¹ ìƒì„±
robot_command = {
    "action": "HAPPY",
    "message": "ì˜¤ëŠ˜ì€ ì •ë§ ë©‹ì§„ í•˜ë£¨ë„¤ìš”!"
}

# MCPë¥¼ í†µí•œ ë¡œë´‡ ì œì–´ ì‹¤í–‰
result = await mcp_manager.execute_robot_command(robot_command)
print(f"ë¡œë´‡ ì œì–´ ê²°ê³¼: {result}")
```

### 3. ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì²˜ë¦¬

```python
from core.stream_processor import StreamProcessor

# ìŠ¤íŠ¸ë¦¬ë° í”„ë¡œì„¸ì„œ ì´ˆê¸°í™”
stream_processor = StreamProcessor()

# ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì‹ 
async def handle_streaming_data():
    async for message in stream_processor.listen_to_queue("robo_feedback"):
        print(f"ìˆ˜ì‹ ëœ í”¼ë“œë°±: {message}")
        
        # AI ì—ì´ì „íŠ¸ê°€ í”¼ë“œë°±ì„ ë¶„ì„í•˜ê³  ì‘ë‹µ ìƒì„±
        ai_response = await agent_manager.analyze_feedback(message)
        print(f"AI ë¶„ì„ ê²°ê³¼: {ai_response}")

# ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘
await handle_streaming_data()
```

## ğŸ§ª í…ŒìŠ¤íŠ¸

### 1. ë¡œì»¬ í…ŒìŠ¤íŠ¸

```bash
# ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
python scripts/test_main.py

# MCP ì›ê²© ì—°ê²° í…ŒìŠ¤íŠ¸
python scripts/test_mcp_remote.py

# ë¡œë´‡ ë„êµ¬ í…ŒìŠ¤íŠ¸
python tools/test_robot_tools.py
```

### 2. í†µí•© í…ŒìŠ¤íŠ¸

```bash
# ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸
./scripts/test_local.sh

# ë¡œê·¸ í™•ì¸
./scripts/logs.sh
```

### 3. í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì˜ˆì‹œ

```
ğŸ§  Agent Runtime í…ŒìŠ¤íŠ¸ ì‹œì‘
âœ… Bedrock ì—°ê²° ì„±ê³µ
âœ… MCP ì„œë²„ ì—°ê²° ì„±ê³µ
âœ… SQS í ì—°ê²° ì„±ê³µ

ğŸ¤– ë¡œë´‡ ì œì–´ í…ŒìŠ¤íŠ¸:
  ì…ë ¥: "ë¡œë´‡ì„ ê¸°ì˜ê²Œ ë§Œë“¤ì–´ ì£¼ì„¸ìš”"
  ì¶œë ¥: {"action": "HAPPY", "message": "ì •ë§ ê¸°ì©ë‹ˆë‹¤!"}
  ê²°ê³¼: ì„±ê³µ

ğŸ“Š ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸:
  í”¼ë“œë°± ìˆ˜ì‹ : {"status": "success", "timestamp": "2024-01-01T00:00:00Z"}
  AI ë¶„ì„: "ë¡œë´‡ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ê³  ìˆìŠµë‹ˆë‹¤."
```

## ğŸ”’ ë³´ì•ˆ ë° ì¸ì¦

### AWS Cognito ì¸ì¦
```python
from auth.access_token import AccessTokenManager

# í† í° ê´€ë¦¬ì ì´ˆê¸°í™”
token_manager = AccessTokenManager()

# ì¸ì¦ í† í° íšë“
access_token = await token_manager.get_access_token()

# í† í° ê°±ì‹ 
refreshed_token = await token_manager.refresh_token()
```

### AWS Secrets Manager
```python
import boto3
import json

# Secrets Managerì—ì„œ ë¯¼ê°í•œ ì •ë³´ ë¡œë“œ
secrets_client = boto3.client('secretsmanager')
secret_response = secrets_client.get_secret_value(SecretId='your-secret-name')
secret_data = json.loads(secret_response['SecretString'])
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### ë¡œê·¸ ì„¤ì •
```python
from utils.logger import setup_logger

# ë¡œê±° ì„¤ì •
logger = setup_logger(__name__)

# ë¡œê·¸ ë ˆë²¨ë³„ ê¸°ë¡
logger.info("Agent Runtime ì‹œì‘")
logger.warning("MCP ì—°ê²° ì§€ì—° ê°ì§€")
logger.error("ë¡œë´‡ ì œì–´ ì‹¤íŒ¨")
```

### CloudWatch í†µí•©
- ìë™ ë¡œê·¸ ìˆ˜ì§‘ ë° ë¶„ì„
- ë©”íŠ¸ë¦­ ëŒ€ì‹œë³´ë“œ êµ¬ì„±
- ì•Œë¦¼ ì„¤ì •

## ğŸš€ ì„±ëŠ¥ ìµœì í™”

### ë¹„ë™ê¸° ì²˜ë¦¬
- asyncioë¥¼ í™œìš©í•œ ë¹„ë™ê¸° I/O
- ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ë¡œ ë†’ì€ ì²˜ë¦¬ëŸ‰ ë³´ì¥
- ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µìœ¼ë¡œ ì§€ì—° ì‹œê°„ ìµœì†Œí™”

### ë©”ëª¨ë¦¬ ê´€ë¦¬
- ëŒ€í™” íˆìŠ¤í† ë¦¬ ì••ì¶•
- ë¶ˆí•„ìš”í•œ ì»¨í…ìŠ¤íŠ¸ ì •ë¦¬
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§

### ìºì‹± ì „ëµ
- ìì£¼ ì‚¬ìš©ë˜ëŠ” ì‘ë‹µ ìºì‹±
- í† í° ì¬ì‚¬ìš©ìœ¼ë¡œ API í˜¸ì¶œ ìµœì í™”
- Redisë¥¼ í™œìš©í•œ ë¶„ì‚° ìºì‹± (ì„ íƒì‚¬í•­)

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- [Amazon Bedrock Claude ëª¨ë¸ ê°€ì´ë“œ](https://docs.aws.amazon.com/bedrock/latest/userguide/claude.html)
- [Model Context Protocol (MCP) ë¬¸ì„œ](https://modelcontextprotocol.io/)
- [AWS Lambda í•¨ìˆ˜ ê°œë°œ ê°€ì´ë“œ](https://docs.aws.amazon.com/lambda/latest/dg/python-programming-model.html)
- [Strands Agent SDK ë¬¸ì„œ](https://docs.strands.ai/)
